---
// Brief Form for "Start a Project" submissions
---

<div class="rounded-[1.25rem] bg-panel soft-border shadow-lg p-[var(--space-3)] backdrop-blur-sm">
  <h3 class="font-display font-bold text-[var(--step-1)] mb-4">
    Start a Project
  </h3>
  
  <div id="brief-notice" class="hidden mb-4 p-4 rounded-xl text-sm"></div>
  
  <form id="brief-form" class="space-y-4">
    <div class="grid grid-cols-2 gap-3">
      <label class="block">
        <span class="text-xs uppercase tracking-widest text-muted">Your name</span>
        <input
          name="name"
          class="mt-2 w-full rounded-pill bg-[rgb(var(--bg))]/35 soft-border px-4 py-3 outline-none focus:shadow-glow"
          required
        />
      </label>
      <label class="block">
        <span class="text-xs uppercase tracking-widest text-muted">Email</span>
        <input
          name="email"
          type="email"
          class="mt-2 w-full rounded-pill bg-[rgb(var(--bg))]/35 soft-border px-4 py-3 outline-none focus:shadow-glow"
          required
        />
      </label>
    </div>
    
    <label class="block">
      <span class="text-xs uppercase tracking-widest text-muted">Business / Niche</span>
      <input
        name="business"
        placeholder="e.g. Real Estate, Coaching, SaaS"
        class="mt-2 w-full rounded-pill bg-[rgb(var(--bg))]/35 soft-border px-4 py-3 outline-none focus:shadow-glow"
      />
    </label>
    
    <label class="block">
      <span class="text-xs uppercase tracking-widest text-muted">What do you need?</span>
      <input
        name="package"
        placeholder="Brand / Web / Bot"
        class="mt-2 w-full rounded-pill bg-[rgb(var(--bg))]/35 soft-border px-4 py-3 outline-none focus:shadow-glow"
      />
    </label>
    
    <label class="block">
      <span class="text-xs uppercase tracking-widest text-muted">Details</span>
      <textarea
        name="details"
        rows={3}
        placeholder="Brief overview of your project..."
        class="mt-2 w-full rounded-2xl bg-[rgb(var(--bg))]/35 soft-border px-4 py-3 outline-none focus:shadow-glow resize-none"
      ></textarea>
    </label>
    
    <button
      type="submit"
      class="w-full rounded-pill px-6 py-4 font-bold btn-primary text-[rgb(var(--bg))] hover:scale-[1.02] transition"
    >
      Send Brief
    </button>
  </form>
</div>

<script>
  const initBriefForm = () => {
    const form = document.getElementById("brief-form") as HTMLFormElement;
    const notice = document.getElementById("brief-notice");

    if (!form || !notice) return;

    const showNotice = (message: string, isError = false) => {
      notice.textContent = message;
      notice.className = `mb-4 p-4 rounded-xl text-sm ${
        isError 
          ? "bg-red-500/20 text-red-300 border border-red-500/30" 
          : "bg-green-500/20 text-green-300 border border-green-500/30"
      }`;
      notice.classList.remove("hidden");
    };

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = {
        name: formData.get("name"),
        email: formData.get("email"),
        business: formData.get("business"),
        package: formData.get("package"),
        details: formData.get("details"),
        ts: new Date().toISOString(),
        source: "website-brief",
      };

      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "Sending...";
      submitBtn.disabled = true;

      try {
        const res = await fetch("/api/brief", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          showNotice("Brief sent! I'll get back to you within 24 hours. ðŸš€");
          form.reset();
        } else {
          const text = await res.text();
          showNotice(text || "Something went wrong. Try again.", true);
        }
      } catch (err) {
        showNotice("Couldn't send. Email me directly at pjames1643@gmail.com", true);
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });
  };

  document.addEventListener("DOMContentLoaded", initBriefForm);
  document.addEventListener("astro:page-load", initBriefForm);
</script>
