---
// Pricing Modal with three tiers
interface PricingTier {
  name: string;
  price: string;
  timeline: string;
  features: string[];
  popular?: boolean;
}

const tiers: PricingTier[] = [
  {
    name: "Brand Identity Sprint",
    price: "$500–$750",
    timeline: "5 days",
    features: [
      "Logo Design",
      "Color Palette + Typography",
      "5 Social Media Templates",
      "AI-Generated Patterns",
      "Niche Content Ideas",
    ],
  },
  {
    name: "Conversion Engine",
    price: "$1,500–$2,500",
    timeline: "2–3 weeks",
    popular: true,
    features: [
      "High-Performance Landing Page",
      "Custom UI/UX Design",
      "AI Lead-Qualification Bot",
      "Automated Lead Routing",
      "Mobile Optimized",
      "30-Day Support",
    ],
  },
  {
    name: "Full Business Architect",
    price: "$5,000–$10,000+",
    timeline: "4–6 weeks",
    features: [
      "Everything in Conversion Engine",
      "Complete Brand Identity",
      "CRM + Automated Sequences",
      "Email + WhatsApp Flows",
      "AI Dashboard for Team",
      "90-Day Priority Support",
    ],
  },
];
---

<dialog
  id="pricing-modal"
  style="margin: auto;"
  class="w-[min(95vw,64rem)] rounded-[2rem] bg-[rgb(var(--panel))] soft-border p-0 backdrop:bg-black/85 backdrop:backdrop-blur-sm"
>
  <div class="relative max-h-[90vh] overflow-y-auto p-8 lg:p-12" data-lenis-prevent>
    <!-- Close Button -->
    <button
      id="pricing-modal-close"
      class="absolute top-6 right-6 p-2 rounded-full hover:bg-text/10 transition"
      aria-label="Close pricing"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12" />
      </svg>
    </button>

    <!-- Header -->
    <div class="text-center mb-10">
      <p class="text-[var(--step--1)] uppercase tracking-[0.18em] text-[rgb(var(--accent))] font-medium mb-3">
        Pricing
      </p>
      <h2 class="font-display font-bold text-[var(--step-3)] leading-[1.1]">
        Choose Your Growth Package
      </h2>
    </div>

    <!-- Pricing Grid -->
    <div class="grid gap-4 md:grid-cols-3">
      {tiers.map((tier) => (
        <div class={`rounded-[1.5rem] soft-border p-6 flex flex-col ${
          tier.popular 
            ? "bg-gradient-to-b from-[rgb(var(--accent))]/20 to-transparent border-[rgb(var(--accent))]/30" 
            : "bg-[rgb(var(--bg))]/40"
        }`}>
          {tier.popular && (
            <span class="text-xs uppercase tracking-widest text-[rgb(var(--accent))] font-bold mb-2">
              Most Popular
            </span>
          )}
          <h3 class="font-display font-bold text-xl">{tier.name}</h3>
          <p class="text-[var(--step-2)] font-bold text-[rgb(var(--accent))] mt-2">{tier.price}</p>
          <p class="text-sm text-muted mb-4">{tier.timeline}</p>
          <ul class="space-y-2 flex-1 mb-6">
            {tier.features.map((feature) => (
              <li class="flex gap-2 text-sm">
                <span class="text-[rgb(var(--accent))]">✓</span>
                {feature}
              </li>
            ))}
          </ul>
          <a
            href="#contact"
            class="w-full text-center rounded-full px-5 py-3 font-medium btn-ghost soft-border hover:bg-[rgb(var(--accent))]/10 hover:border-[rgb(var(--accent))] hover:text-[rgb(var(--accent))] hover:shadow-[0_0_15px_rgb(var(--accent)/0.2)] transition duration-300"
            onclick="document.getElementById('pricing-modal').close()"
          >
            Get Started
          </a>
        </div>
      ))}
    </div>

    <!-- Custom Requirements -->
    <div class="mt-8 rounded-2xl bg-gradient-to-r from-white/5 to-transparent border border-dashed border-white/20 p-6 text-center">
      <h4 class="font-display font-bold text-xl mb-2">Need Something Different?</h4>
      <p class="text-muted text-sm mb-4 max-w-lg mx-auto">
        Have unique requirements? API integrations, multi-site setups, enterprise solutions, 
        or ongoing retainers? Chat with ARCHIBOT in AI mode or submit your brief for a custom quote.
      </p>
      <a
        href="#contact"
        class="inline-flex items-center gap-2 rounded-full px-6 py-3 font-medium btn-ghost soft-border hover:bg-white/10 transition"
        onclick="document.getElementById('pricing-modal').close()"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
        </svg>
        Discuss Custom Requirements
      </a>
    </div>

    <p class="mt-8 text-center text-sm text-muted">
      All prices in USD. Custom quotes available for unique requirements.
    </p>
  </div>
</dialog>

<script>
  const initPricingModal = () => {
    const modal = document.getElementById("pricing-modal") as HTMLDialogElement;
    const openBtn = document.getElementById("pricing-btn");
    const closeBtn = document.getElementById("pricing-modal-close");

    if (!modal || !openBtn || !closeBtn) return;

    openBtn.addEventListener("click", () => modal.showModal());
    closeBtn.addEventListener("click", () => modal.close());

    // Close on backdrop click
    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.close();
    });
  };

  const toggleLenis = (pause: boolean) => {
    if ((window as any).lenis) {
      pause ? (window as any).lenis.stop() : (window as any).lenis.start();
    }
    document.body.style.overflow = pause ? 'hidden' : '';
  };

  document.addEventListener("DOMContentLoaded", initPricingModal);
  document.addEventListener("astro:page-load", initPricingModal);

  // Hook into open/close actions
  const originalShowModal = HTMLDialogElement.prototype.showModal;
  const originalClose = HTMLDialogElement.prototype.close;

  HTMLDialogElement.prototype.showModal = function() {
    if (this.id === 'pricing-modal') toggleLenis(true);
    originalShowModal.call(this);
  };

  HTMLDialogElement.prototype.close = function() {
    if (this.id === 'pricing-modal') toggleLenis(false);
    originalClose.call(this);
  };
</script>
