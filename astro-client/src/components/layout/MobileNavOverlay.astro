---
// MobileNavOverlay - Full screen mobile menu
// PERFORMANCE: No blur filters
// COLOR: Void & Ember (Black + Orange)
interface NavLink {
  href: string;
  label: string;
}

const navLinks: NavLink[] = [
  { href: "#work", label: "Work" },
  { href: "#services", label: "Solutions" },
  { href: "#about", label: "About" },
  { href: "#contact", label: "Contact" },
];
---

<!-- Mobile Nav Overlay - Dark Mode -->
<div
  id="mobile-nav"
  class="fixed inset-0 z-[100] bg-bg opacity-0 pointer-events-none transition-opacity duration-300"
  aria-hidden="true"
>
  <div class="flex flex-col h-full">
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-zinc-800">
      <a href="/" class="outline-none" id="mobile-logo">
        <img
          src="/logo-new.png"
          alt="P. JAMES"
          class="h-10 w-auto object-contain"
        />
      </a>
      
      <!-- Close Button -->
      <button
        id="mobile-nav-close"
        class="p-2 rounded-full hover:bg-zinc-800 transition text-zinc-400 hover:text-white"
        aria-label="Close menu"
      >
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Nav Links -->
    <nav class="flex-1 flex flex-col justify-center px-8">
      <ul class="space-y-2">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="mobile-nav-link block text-3xl font-bold text-zinc-300 hover:text-orange-400 py-4 border-b border-zinc-800 transition-colors"
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- Bottom CTA - Uses .action-book -->
    <div class="p-6 border-t border-zinc-800">
      <button
        id="mobile-nav-cta"
        class="action-book w-full flex items-center justify-center gap-3 px-6 py-4 bg-orange-500 text-black font-bold text-lg rounded-full hover:bg-orange-400 transition-all"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
        </svg>
        Book a Call
      </button>
    </div>
  </div>
</div>

<script>
  const initMobileNav = () => {
    const overlay = document.getElementById("mobile-nav");
    const openBtn = document.getElementById("nav-toggle");
    const closeBtn = document.getElementById("mobile-nav-close");
    const logo = document.getElementById("mobile-logo");
    const navLinks = overlay?.querySelectorAll(".mobile-nav-link");

    if (!overlay || !openBtn || !closeBtn) return;

    const open = () => {
      overlay.classList.remove("opacity-0", "pointer-events-none");
      overlay.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
      if ((window as any).lenis) (window as any).lenis.stop();
    };

    const close = () => {
      overlay.classList.add("opacity-0", "pointer-events-none");
      overlay.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      if ((window as any).lenis) (window as any).lenis.start();
    };

    openBtn.addEventListener("click", open);
    closeBtn.addEventListener("click", close);
    logo?.addEventListener("click", close);

    // Close on nav link click
    navLinks?.forEach((link) => {
      link.addEventListener("click", close);
    });

    // Close on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !overlay.classList.contains("opacity-0")) {
        close();
      }
    });

    // Explicit Click Handler for Mobile CTA
    const ctaBtn = document.getElementById("mobile-nav-cta");
    ctaBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      window.dispatchEvent(new CustomEvent("open-booking-modal"));
      close(); // Close menu after opening modal
    });
  };

  document.addEventListener("DOMContentLoaded", initMobileNav);
  document.addEventListener("astro:page-load", initMobileNav);
</script>
