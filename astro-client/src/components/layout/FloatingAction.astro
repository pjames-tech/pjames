---
// FloatingAction.astro
// Desktop: Back to Top (subtle)
// Mobile: Sticky "Book Now" pill button (Money Button)
// Uses .action-book for global event delegation
---

<!-- Desktop: Back to Top -->
<button
  id="back-to-top"
  class="hidden md:flex fixed bottom-6 right-6 z-50 p-3 rounded-full bg-zinc-800 text-white border border-zinc-700 shadow-lg hover:bg-zinc-700 hover:scale-110 transition-all duration-300 opacity-0 pointer-events-none"
  aria-label="Back to top"
>
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2.5"
  >
    <path d="M18 15l-6-6-6 6" />
  </svg>
</button>

<!-- Mobile: Floating Phone CTA (Money Button) - Uses .action-book -->
<button
  id="mobile-book-cta"
  class="action-book md:hidden fixed bottom-6 right-6 z-50 flex items-center justify-center w-14 h-14 rounded-full bg-orange-500 text-white shadow-lg transition-all duration-300 opacity-0 pointer-events-none hover:scale-105"
  aria-label="Book Now"
  style="box-shadow: 0 0 25px rgba(249, 115, 22, 0.4);"
>
  <!-- Phone Icon -->
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
  </svg>
</button>

<script>
  const initFloatingAction = () => {
    const backToTop = document.getElementById("back-to-top");
    const mobileBookCta = document.getElementById("mobile-book-cta");
    
    const threshold = window.innerHeight * 0.5;

    // Show/hide based on scroll
    const handleScroll = () => {
      const isVisible = window.scrollY > threshold;
      
      // Desktop: Back to Top
      if (backToTop) {
        backToTop.classList.toggle("opacity-0", !isVisible);
        backToTop.classList.toggle("pointer-events-none", !isVisible);
      }
      
      // Mobile: Book CTA
      if (mobileBookCta) {
        mobileBookCta.classList.toggle("opacity-0", !isVisible);
        mobileBookCta.classList.toggle("pointer-events-none", !isVisible);
      }
    };

    // Back to Top click
    if (backToTop) {
      backToTop.addEventListener("click", () => {
        if ((window as any).lenis) {
          (window as any).lenis.scrollTo(0, { 
            duration: 1.5, 
            easing: (t: number) => Math.min(1, 1.001 - Math.pow(2, -10 * t)) 
          });
        } else {
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
    }

    // Mobile Book CTA handled by global .action-book event delegation
    // BUT we add explicit fallback just in case
    mobileBookCta?.addEventListener("click", (e) => {
      e.stopPropagation(); 
      window.dispatchEvent(new CustomEvent("open-booking-modal"));
    });

    window.addEventListener("scroll", handleScroll, { passive: true });
    handleScroll();
  };

  document.addEventListener("DOMContentLoaded", initFloatingAction);
  document.addEventListener("astro:page-load", initFloatingAction);
</script>
