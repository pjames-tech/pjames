---
// Process Section - Vertical Animated Timeline
// Adapts the user's requested "moving line" design to the Value & Ember aesthetic

interface ProcessStep {
  title: string;
  description: string;
  icon: string;
}

const steps: ProcessStep[] = [
  {
    title: "Discovery and Setup",
    description: "We align on your SKUs, workflows, and platforms—then lay out a simple onboarding plan with clear next steps. You'll know what's happening, what's expected, and who's in charge of what from the start.",
    icon: `<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />` // Check/Scale
  },
  {
    title: "Systems and Test Run",
    description: "We set up your client portal, map your order workflows, and understand your brand-specific requirements (like kitting, bundles, or Amazon prep). You'll review everything in Packiyo and walk through a test order—so nothing gets missed at launch.",
    icon: `<path d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />` // Box/Test
  },
  {
    title: "Go Live and Ongoing Support",
    description: "Once inventory arrives, we are ready to ship the next day with full visibility and real-time updates. You'll have direct access to the team running your fulfillment.",
    icon: `<path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />` // Plane/Launch
  }
];
---

<section id="process" class="py-24 relative overflow-hidden">
  <div class="container-fluid max-w-4xl mx-auto px-6">
    
    <!-- Section Header -->
    <div class="text-center mb-16">
      <span class="inline-block px-4 py-1.5 mb-4 text-xs font-bold tracking-widest text-[#FF7300] uppercase bg-[#FF7300]/10 rounded-full border border-[#FF7300]/20">
        The Protocol
      </span>
      <h2 class="font-display font-bold text-4xl md:text-5xl text-white mb-4">
        From Concept to <span class="text-[#FF7300]">Command.</span>
      </h2>
      <p class="text-zinc-400 max-w-lg mx-auto">
        A linear path to market dominance. No fluff, just execution.
      </p>
    </div>

    <!-- Timeline Container -->
    <div class="relative">
      <!-- Vertical Line Background (The 'Track') -->
      <div class="absolute left-[28px] md:left-1/2 top-0 bottom-0 w-[2px] bg-zinc-800 -translate-x-1/2 md:translate-x-0"></div>

      <!-- Vertical Line Fill (The 'Progress') -->
      <div id="timeline-progress" class="absolute left-[28px] md:left-1/2 top-0 w-[2px] bg-[#FF7300] -translate-x-1/2 md:translate-x-0 h-0 shadow-[0_0_15px_#FF7300]"></div>

      <div class="space-y-16 md:space-y-24 relative z-10">
        {steps.map((step, index) => (
          <div class="timeline-step flex flex-row items-start md:items-center gap-6 md:gap-8">
            
            <!-- LEFT COLUMN (Text for Steps 1 & 3) -->
            <div class={`flex-1 text-left md:text-right order-2 md:order-1 pt-1 md:pt-0 ${index % 2 !== 0 ? 'hidden md:block' : ''}`}>
              {index % 2 === 0 && (
                <div class="reveal-content opacity-0 translate-y-4 transition-all duration-700 delay-100">
                  <h3 class="text-2xl font-bold text-white mb-2">{step.title}</h3>
                  <p class="text-zinc-400 leading-relaxed max-w-md ml-auto">{step.description}</p>
                </div>
              )}
            </div>

            <!-- CENTER ICON -->
            <div class="relative flex-shrink-0 z-20 w-14 order-1 md:order-2">
               <div class="step-marker w-14 h-14 rounded-full bg-black border-2 border-zinc-800 flex items-center justify-center text-zinc-500 relative z-20 transition-all duration-500 shadow-xl">
                 <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" set:html={step.icon}></svg>
               </div>
               <!-- Pulse effect -->
               <div class="step-pulse absolute inset-0 rounded-full bg-[#FF7300]/20 scale-0 transition-transform duration-500 -z-10"></div>
            </div>

            <!-- RIGHT COLUMN (Text for Step 2) -->
            <div class={`flex-1 text-left order-3 md:order-3 pt-1 md:pt-0 ${index % 2 === 0 ? 'hidden md:block' : ''}`}>
              {index % 2 !== 0 && (
                 <div class="reveal-content opacity-0 translate-y-4 transition-all duration-700 delay-100">
                    <h3 class="text-2xl font-bold text-white mb-2">{step.title}</h3>
                    <p class="text-zinc-400 leading-relaxed max-w-md mr-auto">{step.description}</p>
                 </div>
              )}
            </div>

          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<script>
  const initTimeline = () => {
    const section = document.getElementById('process');
    const progressBar = document.getElementById('timeline-progress');
    const markers = document.querySelectorAll('.step-marker');
    const pulses = document.querySelectorAll('.step-pulse');
    const steps = document.querySelectorAll('.timeline-step');
    
    if (!section || !progressBar) return;

    const handleScroll = () => {
      const windowHeight = window.innerHeight;
      const rect = section.getBoundingClientRect();
      const relativeY = -rect.top + (windowHeight / 2); 
      const totalHeight = section.scrollHeight;
      
      let progress = (relativeY / totalHeight) * 100;
      progress = Math.max(0, Math.min(100, progress)); // Strict 1:1 sync, no lookahead
      
      progressBar.style.height = `${progress}%`;

      markers.forEach((marker, index) => {
        const markerRect = marker.getBoundingClientRect();
        // Trigger exactly when line hits element (Center of screen)
        const triggerPoint = windowHeight / 2 + 20; // Slight buffer (20px) to ensure line "touches" it
        
        // Find content relative to this step container
        const stepContainer = markers[index].closest('.timeline-step');
        const content = stepContainer?.querySelector('.reveal-content');

        if (markerRect.top < triggerPoint) {
           marker.classList.add('border-[#FF7300]', 'text-[#FF7300]', 'bg-[#FF7300]/10', 'shadow-[0_0_20px_rgba(255,115,0,0.3)]');
           marker.classList.remove('border-zinc-800', 'text-zinc-500');
           
           pulses[index]?.classList.remove('scale-0');
           pulses[index]?.classList.add('scale-150', 'opacity-0');
           
           if (content) {
             content.classList.remove('opacity-0', 'translate-y-4');
           }
        } else {
           marker.classList.remove('border-[#FF7300]', 'text-[#FF7300]', 'bg-[#FF7300]/10', 'shadow-[0_0_20px_rgba(255,115,0,0.3)]');
           marker.classList.add('border-zinc-800', 'text-zinc-500');
           pulses[index]?.classList.add('scale-0');
        }
      });
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  };

  document.addEventListener('DOMContentLoaded', initTimeline);
  document.addEventListener('astro:page-load', initTimeline);
</script>

<style>
  /* Custom easing for the line */
  #timeline-progress {
    will-change: height;
  }
</style>
